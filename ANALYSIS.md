# Анализ проекта "Tiles Survive! Guides"

*Анализ выполнен 2026-02-08*

## Общее описание
Веб-приложение на React с системой аналитики посещений для игры Tiles Survive!. Это одностраничное приложение (SPA) с бэкендом на Go для логирования аналитических данных.

## Архитектура проекта

### **Фронтенд:**
- **React 19** + **TypeScript**
- **Vite** - сборщик и dev-сервер
- **Tailwind CSS 4** - стилизация
- **React Router DOM 7** - маршрутизация
- **Axios** - HTTP-запросы

### **Бэкенд:**
- **Go 1.24.3** сервер для логирования аналитики
- Хранение данных в JSON-файле `logs.json`
- Два эндпоинта: `POST /api/log` и `GET /logs`

### **Инструменты:**
- **ESLint** - линтинг
- **PostCSS** + **Autoprefixer** - обработка CSS
- **TypeScript** - типизация

### **Внешние сервисы:**
- **ipinfo.io** - определение геолокации по IP
- **Яндекс.Метрика** и **Google Analytics** - аналитика

## Структура проекта

```
maf-guides/
├── src/                    # Исходный код React приложения
│   ├── components/        # React компоненты
│   │   ├── AnimatedBackground.tsx   # Анимированный фон
│   │   ├── GuideCard.tsx           # Карточка гайда
│   │   └── GuideModal.tsx          # Модальное окно
│   ├── hooks/            # Пользовательские хуки
│   │   └── useAnalytics.ts         # Хук для аналитики
│   ├── pages/            # Страницы
│   │   └── MainPage.tsx            # Главная страница
│   ├── services/         # Сервисы
│   │   └── analytics.ts            # Логика сбора аналитики
│   ├── App.tsx           # Корневой компонент
│   ├── main.tsx          # Точка входа
│   └── index.css         # Глобальные стили
├── server/               # Go сервер логирования
│   ├── main.go          # Основной код сервера
│   ├── go.mod           # Go модули
│   ├── logs.json        # Файл логов
│   └── logserver.exe    # Скомпилированный сервер
├── public/               # Статические файлы
│   └── images/          # Изображения (SVG)
├── dist/                 # Собранная версия
├── .github/workflows/    # CI/CD (автодеплой на VPS)
├── package.json          # Зависимости фронтенда
├── vite.config.ts       # Конфигурация Vite
├── tailwind.config.js   # Конфигурация Tailwind CSS
├── tsconfig.*.json      # Конфигурации TypeScript
├── .env.local           # Переменные окружения
├── README.md            # Документация проекта
└── DEPLOYMENT.md        # Инструкции по деплою
```

## Ключевые функции

### 1. Отображение гайдов
- 6 тестовых категорий: Выживание, Исследование, Бой, Крафтинг, Экономика, Достижения
- Фильтрация по категориям и сложности
- Поиск по названиям гайдов
- Адаптивный дизайн для мобильных и десктоп

### 2. Система аналитики посещений
- **Отслеживание переходов** по уникальным ссылкам вида `/maf/{id}`
- **Сбор данных о посетителях**:
  - Геолокация (страна, регион, город) через ipinfo.io API
  - Устройство, браузер (из User Agent)
  - Разрешение экрана и язык
  - Время посещения и реферер
- **Интеграция с аналитическими сервисами**: Яндекс.Метрика и Google Analytics

### 3. Динамический UI
- Анимации с использованием Tailwind CSS
- Градиенты и интерактивные элементы
- Модальные окна для детального просмотра гайдов

## Сервер логирования (Go)

### API эндпоинты:
1. `POST /api/log` - прием логов аналитики в формате JSON
2. `GET /logs` - получение всех сохраненных логов

### Особенности реализации:
- **Коррекция IP** через заголовки `X-Forwarded-For`, `X-Real-IP`
- **Интеграция с ipinfo.io** для определения геолокации
- **Потокобезопасность** с использованием `sync.Mutex`
- **Хранение данных** в файле `logs.json` (каждая запись на новой строке)

### Пример структуры лога:
```json
{
  "linkId": "123",
  "timestamp": "2026-02-08T10:30:00Z",
  "ipAddress": "192.168.1.1",
  "country": "Russia",
  "countryCode": "RU",
  "region": "Moscow",
  "city": "Moscow",
  "userAgent": "Mozilla/5.0...",
  "referrer": "https://example.com",
  "screenResolution": "1920x1080",
  "language": "ru-RU"
}
```

## Конфигурация и переменные окружения

Ключевые настройки в `.env.local`:
```
# Аналитика
VITE_ANALYTICS_ENDPOINT=http://localhost:3000/api/analytics

# IPInfo.io токен для геолокации (получите бесплатный на https://ipinfo.io/)
VITE_IPINFO_TOKEN=

# Режим разработки
VITE_APP_ENV=development

# Логирование
VITE_LOG_ENDPOINT=http://localhost:3002/api/log
```

## Деплой и инфраструктура

### Автоматический деплой (CI/CD)
- **GitHub Actions** автоматически деплоит на VPS при push в `main`/`master`
- **Целевой сервер**: VPS с Debian 11, IP: 45.135.233.197
- **Процесс деплоя**:
  1. Сборка проекта (Vite)
  2. Копирование файлов из `dist/` на сервер через rsync
  3. Настройка systemd сервиса для Go сервера

### Ручной деплой
- **Vercel**: `vercel --prod`
- **Любой хостинг**: копирование файлов из `dist/`
- **Требования к серверу**: SPA-маршрутизация (все запросы на `/maf/*` → `index.html`)

### Конфигурация Nginx:
```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /var/www/html;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

## Зависимости

### Фронтенд (package.json):
**Основные зависимости:**
- `react`, `react-dom` (^19.2.0)
- `react-router-dom` (^7.13.0)
- `axios` (^1.13.4)

**Dev-зависимости:**
- `@vitejs/plugin-react` (^5.1.1)
- `tailwindcss` (^4.1.18)
- `typescript` (~5.9.3)
- `vite` (^7.2.4)

### Бэкенд (go.mod):
- Go 1.24.3
- Стандартная библиотека (net/http, encoding/json, sync, os, time)

## Команды разработки

```bash
# Установка зависимостей
npm install

# Запуск в режиме разработки
npm run dev                    # Фронтенд на http://localhost:5174
npm run server                # Go сервер на http://localhost:3002

# Сборка для production
npm run build                 # Создает папку dist/

# Просмотр собранной версии
npm run preview

# Линтинг
npm run lint
```

## Потенциальные улучшения

1. **Замена тестовых данных** на реальные гайды по игре Tiles Survive!
2. **Административная панель** для просмотра и анализа логов
3. **База данных** вместо файлового хранилища для логов
4. **Аутентификация** для доступа к логам
5. **Экспорт логов** в CSV/Excel форматах
6. **Дашборд аналитики** с графиками и статистикой
7. **Оптимизация изображений** (текущие SVG сгенерированы программно)

## Статус проекта

✅ **Полностью функционален** - готов к развертыванию
✅ **Настроен CI/CD** - автоматический деплой на VPS
✅ **Документирован** - подробные README и DEPLOYMENT файлы
✅ **Тестовые данные** - 6 демонстрационных гайдов
✅ **Аналитика** - полная система сбора данных о посещениях

Проект является демонстрацией возможностей React с системой аналитики посещений и может быть адаптирован для реального использования.

---

## Контекст для разработчика

### Архитектурные решения:
1. **Разделение фронтенда и бэкенда** - независимое развитие и масштабирование
2. **SPA-архитектура** - быстрая навигация без перезагрузок страниц
3. **Файловое хранилище логов** - простота для демонстрации, легко заменить на БД
4. **Микросервисный подход** - Go сервер можно развернуть отдельно

### Безопасность:
- **CORS** настроен для всех источников (в продакшене ограничить)
- **Валидация JSON** на сервере
- **Обработка ошибок** с логированием

### Производительность:
- **Vite** для быстрой сборки и горячей перезагрузки
- **Tailwind CSS 4** для оптимизированных стилей
- **Ленивая загрузка** компонентов (при необходимости)

### Масштабируемость:
- **Статический фронтенд** можно разместить на CDN
- **Go сервер** легко масштабировать горизонтально
- **Файловое хранилище** можно заменить на Redis/PostgreSQL